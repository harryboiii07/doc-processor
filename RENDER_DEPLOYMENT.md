# Deploy Excel Converter API to Render

This guide walks you through deploying the Excel to JSON Converter API to Render.com.

## 🚀 Quick Deployment Steps

### 1. Prepare Your Repository

Ensure your code is pushed to a Git repository (GitHub, GitLab, or Bitbucket):

```bash
# If not already initialized
git init
git add .
git commit -m "Initial commit: Excel Converter API"

# Push to your repository
git remote add origin <your-repo-url>
git push -u origin main
```

### 2. Deploy on Render

#### Option A: Using render.yaml (Recommended)

1. **Connect Repository**: Go to [Render Dashboard](https://dashboard.render.com)
2. **New → Blueprint**: Choose "New Blueprint"
3. **Connect Repository**: Select your repository
4. **Deploy**: Render will automatically read `render.yaml` and deploy

#### Option B: Manual Setup

1. **New Web Service**: Go to Render Dashboard → New → Web Service
2. **Connect Repository**: Select your repository
3. **Configure Service**:
   - **Name**: `excel-converter-api`
   - **Runtime**: `Python 3`
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn excel_converter.wsgi:application --bind 0.0.0.0:$PORT --workers 4 --timeout 300`
   - **Plan**: Start with "Starter" (free tier available)

### 3. Environment Variables

Render will automatically set most variables, but verify these in your service settings:

| Variable | Value | Description |
|----------|-------|-------------|
| `DEBUG` | `false` | Disable debug mode in production |
| `ALLOWED_HOSTS` | `*` | Allow all hosts (will be restricted to your domain) |
| `SECRET_KEY` | `<auto-generated>` | Django secret key (auto-generated by Render) |
| `DATA_UPLOAD_MAX_MEMORY_SIZE` | `104857600` | 100MB file upload limit |
| `FILE_UPLOAD_MAX_MEMORY_SIZE` | `104857600` | 100MB file upload limit |

### 4. Custom Domain (Optional)

1. Go to your service settings
2. **Custom Domains** → **Add Custom Domain**
3. Update `ALLOWED_HOSTS` in environment variables to include your domain

## 📋 Service Configuration

### Health Check
- **Path**: `/health`
- **Expected Response**: `200 OK` with JSON status

### Resource Limits
- **Memory**: 512MB (Starter) / 1GB+ (Standard/Pro)
- **CPU**: Shared (Starter) / Dedicated (Standard/Pro)
- **Disk**: 1GB for temporary file storage

### Scaling
- **Workers**: 4 Gunicorn workers (configurable in start command)
- **Timeout**: 300 seconds for large file processing
- **Auto-scaling**: Available on paid plans

## 🔧 Post-Deployment

### 1. Test Your Deployment

```bash
# Health check
curl https://your-app-name.onrender.com/health

# Service info
curl https://your-app-name.onrender.com/info

# Test conversion (replace with your actual URL)
curl -X POST https://your-app-name.onrender.com/api/convert-excel \
  -F "file=@sample.xlsx" \
  -H "Accept: application/json"
```

### 2. Monitor Logs

- Go to your service in Render Dashboard
- **Logs** tab shows real-time application logs
- Look for startup messages and any errors

### 3. Performance Monitoring

Monitor these metrics in Render Dashboard:
- **Response Time**: Should be < 2s for small files
- **Memory Usage**: Monitor for memory leaks
- **CPU Usage**: Should be reasonable during processing
- **Error Rate**: Aim for < 1% error rate

## 🛠️ Troubleshooting

### Common Issues

1. **Build Fails**: Check `build.sh` permissions and dependencies
   ```bash
   chmod +x build.sh
   ```

2. **Memory Issues**: Upgrade to Standard plan for larger files
   
3. **Timeout Issues**: Increase timeout in start command:
   ```bash
   gunicorn excel_converter.wsgi:application --bind 0.0.0.0:$PORT --workers 4 --timeout 600
   ```

4. **Static Files Issues**: Ensure WhiteNoise is installed and configured

### Debugging Steps

1. **Check Logs**: Render Dashboard → Your Service → Logs
2. **Health Check**: Visit `/health` endpoint
3. **Environment Variables**: Verify all required variables are set
4. **Dependencies**: Ensure all packages in `requirements.txt` are compatible

## 💰 Cost Optimization

### Free Tier (Starter Plan)
- **Limitations**: 
  - 512MB RAM
  - Spins down after 15 minutes of inactivity
  - 750 build hours/month
  - Shared CPU

### Paid Plans
- **Standard**: $7/month - Always on, 1GB RAM, dedicated CPU
- **Pro**: $25/month - 4GB RAM, faster builds, priority support

### Recommendations
- **Development**: Use Starter (free)
- **Production**: Use Standard or Pro for reliability

## 🔒 Security Best Practices

1. **Environment Variables**: Never commit secrets to repository
2. **ALLOWED_HOSTS**: Restrict to your domain in production
3. **HTTPS**: Render provides SSL certificates automatically
4. **File Validation**: Service validates file types and sizes
5. **Rate Limiting**: Consider adding rate limiting for production

## 📈 Scaling Considerations

### Horizontal Scaling
- Increase worker count in start command
- Use Redis for session storage (if needed)
- Consider load balancer for multiple instances

### Vertical Scaling
- Upgrade Render plan for more RAM/CPU
- Monitor memory usage during large file processing

### File Storage
- Current: Temporary files in memory/disk
- Future: Consider cloud storage (AWS S3, Google Cloud) for large files

## 🔄 Continuous Deployment

Render automatically deploys when you push to your main branch:

```bash
git add .
git commit -m "Update: improve Excel processing"
git push origin main
```

The deployment will:
1. Run `build.sh`
2. Install dependencies
3. Start the service
4. Run health checks

## 📞 Support

- **Render Documentation**: [docs.render.com](https://docs.render.com)
- **Render Community**: [community.render.com](https://community.render.com)
- **Service Logs**: Available in Render Dashboard

---

## 🎉 You're Live!

Once deployed, your Excel Converter API will be available at:
`https://your-service-name.onrender.com`

Test it with the health endpoint and start converting Excel files to JSON! 🚀
